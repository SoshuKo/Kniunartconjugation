<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>クニューン語クラス転換器</title>
    <style>
        body {
            background-color: #F09000;
            color: #FFFFFF;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        select, input, button {
            margin: 10px;
            padding: 5px;
            font-size: 16px;
        }
        #outputString {
            font-family: 'kniunart01', Arial, sans-serif;
            font-size: 20px;
            color: #FFFFFF;
        }
    </style>
</head>
<body>
    <h1>クニューン語クラス転換器</h1>
    <select id="verbType">
        <option value="intransitive">自動詞</option>
        <option value="transitive">他動詞</option>
        <option value="ditransitive">間目動詞</option>
    </select>
    <select id="tense">
        <option value="future">未来形</option>
        <option value="present">現在形</option>
        <option value="past">過去形</option>
        <option value="gerund_future">動名詞未来形</option>
        <option value="gerund_present">動名詞現在形</option>
        <option value="imperative">命令形</option>
        <option value="subjunctive_future">接続法未来形</option>
        <option value="subjunctive_present">接続法現在形</option>
        <option value="subjunctive_past">接続法過去形</option>
    </select>
    <select id="person">
        <option value="first">一人称</option>
        <option value="second">二人称</option>
        <option value="third">三人称</option>
    </select>
    <select id="aspect">
        <option value="inceptive">起動相</option>
        <option value="continuative">継続相</option>
        <option value="perfective">完了相</option>
        <option value="prospective">未動相</option>
    </select>
    <input type="checkbox" id="number">複数</input>
    <br>
    <input type="checkbox" id="classConversion">クラス転換</input>
    <select id="classType">
        <option value="class1">クラス1 (男性)</option>
        <option value="class2">クラス2 (女性)</option>
        <option value="class3">クラス3 (中性)</option>
        <option value="class4">クラス4 (抽象)</option>
        <option value="class5">クラス5 (物質)</option>
        <option value="class6">クラス6 (集合)</option>
    </select>
    <input type="text" id="inputString" placeholder="動詞を入力">
    <button onclick="processString()">処理</button>
    <p id="outputString"></p>
    <p>注意: 受動態・使役は非対応です。人力でお願いします。</p>

    <script>
        function processString() {
            const verbType = document.getElementById('verbType').value;
            const tense = document.getElementById('tense').value;
            const person = document.getElementById('person').value;
            const aspect = document.getElementById('aspect').value;
            const number = document.getElementById('number').checked;
            const classConversion = document.getElementById('classConversion').checked;
            const classType = document.getElementById('classType').value;
            let inputString = document.getElementById('inputString').value;

            // 動詞の種類の処理
            if (verbType === 'intransitive') {
                inputString = inputString.replace(/^(ga=|da=)/, 'ba=').replace(/-uf|-ux/g, '-uhr').replace(/-f|-x/g, '-hr');
            } else if (verbType === 'transitive') {
                inputString = inputString.replace(/^(ba=|da=)/, 'ga=').replace(/-uhr|-ux/g, '-uf').replace(/-hr|-x/g, '-f');
            } else if (verbType === 'ditransitive') {
                inputString = inputString.replace(/^(ba=|ga=)/, 'da=').replace(/-uf|-uhr/g, '-ux').replace(/-f|-hr/g, '-x');
            }

            // 相の処理
            if (aspect === 'inceptive') {
                inputString = inputString.replace(/-en|-ed|-at‘/g, '-ab').replace(/-n|-d|-t’/g, '-b');
            } else if (aspect === 'continuative') {
                inputString = inputString.replace(/-ab|-ed|-at‘/g, '-en').replace(/-b|-d|-t’/g, '-n');
            } else if (aspect === 'perfective') {
                inputString = inputString.replace(/-en|-ab|-at‘/g, '-ed').replace(/-n|-b|-t’/g, '-d');
            } else if (aspect === 'prospective') {
                inputString = inputString.replace(/-en|-ed|-ab/g, '-at‘').replace(/-n|-d|-t’/g, '-b');
            }

            // 数の処理
            if (number) {
                inputString = inputString.replace(/-a$/, '-ia').replace(/-e$/, '-ie').replace(/-u$/, '-iú');
            }

            // クラス転換の処理
            if (classConversion) {
                const rootMatch = inputString.match(/=(.*?)-/);
                if (rootMatch) {
                    let root = rootMatch[1];
                    
                    // 母音変換
                    if (classType === 'class2') {
                        root = root.replace(/a/g, 'e');
                    } else if (classType === 'class3') {
                        root = root.replace(/ai/g, 'úi').replace(/au/g, 'íu').replace(/ia/g, 'iú').replace(/ua/g, 'uí').replace(/a/g, 'i');
                    } else if (classType === 'class5') {
                        root = root.replace(/a/g, 'e');
                    } else if (classType === 'class6') {
                        root = root.replace(/ai/g, 'úi').replace(/au/g, 'íu').replace(/ia/g, 'iú').replace(/ua/g, 'uí').replace(/a/g, 'i');
                    }

                    // クラスS転換規則の適用
                    if (classType === 'class4' || classType === 'class5' || classType === 'class6') {
                        const consonantMatch = root.match(/^(b|bl|bm|br|d|dl|dn|dr|dz|dzl|f|fl|fr|g|gh|gl|gn|gr|j|jr|r|s|v|z|zh|zhr|zl|q|x)/);
                        if (consonantMatch) {
                            const consonant = consonantMatch[0];
                            const prefix = classType === 'class4' ? 'sa' : classType === 'class5' ? 'se' : 'si';
                            if (consonant === 'q') {
                                root = 's\'' + root.slice(1);
                            } else if (consonant === 'x') {
                                root = 'sh\'' + root.slice(1);
                            } else {
                                root = prefix + root;
                            }
                        } else {
                            root = 's' + root;
                        }
                    }

                    inputString = inputString.replace(/=(.*?)-/, '=' + root + '-');
                }
            }

            // 人称の処理
            if (person === 'first') {
                inputString = inputString.replace(/^(ba=|ga=|da=)/, match => match + 'mi');
            } else if (person === 'second') {
                inputString = inputString.replace(/^(ba=|ga=|da=)/, match => match + 'zhi');
            }
            
            // 時制の処理
            if (tense === 'future') {
                inputString = inputString.replace(/[=-]/g, '');
            } else if (tense === 'present') {
                inputString = inputString.replace(/^(ba=|ga=|da=)/, '').replace(/-/g, '');
            } else if (tense === 'past') {
                let replaced = false;
                inputString = inputString.replace(/-hr|-uhr|-f|-uf|-x|-ux/g, match => (replaced = true, ''));
                if (replaced) inputString = inputString.replace(/=/g, '-').replace(/^(ba|ga|da)/, '');
            }

            document.getElementById("outputString").innerText = inputString;
        }
    </script>
</body>
</html>
